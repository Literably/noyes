#!/usr/bin/env jruby
# vim: set filetype=ruby :
ROOT = File.dirname(File.dirname(__FILE__))
$: << "#{ROOT}/lib"
$: << "#{ROOT}/lib/common"

require 'optparse'
options = {}
optparse = OptionParser.new do |opt|
  opt.banner = 'Usage: nrec [options] file1 file2 ...'
  opt.on '-v', '--verbose', 'Output more information' do 
    options[:verbose] = true
  end
  options[:implementation] = :ruby
  opt.on '-j', '--java', 'Use java implementation' do
    options[:implementation] = :java
  end
  opt.on( '-h', '--help', 'Display this screen' ) do
    puts opt
    exit
  end
end

optparse.parse!
# Choose implementation
case options[:implementation]
when :java
  $: << "#{ROOT}/lib/java_impl"
  $: << "#{ROOT}/ship"
  require 'javaimpl.jar'
when :ruby
  $: << "#{ROOT}/lib/ruby_impl"
end

require 'socket'
require 'send_incrementally'

def recognize file, node='174.129.244.159', port=2348
  TCPSocket.open(node, port) do |client|
    send_incremental_features file, client, client
  end
end

ARGV.each do |file|
  puts "recognizing file #{file}" if options[:verbose]
  result = recognize file
  puts
  puts "#{result}"
end
