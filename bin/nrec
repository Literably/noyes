#!/usr/bin/env ruby
# vim: set filetype=ruby :
ROOT = File.dirname(File.dirname(__FILE__))
$: << "#{ROOT}/lib" << "#{ROOT}/ship"

require 'optparse'
options = {}
OptionParser.new do |opt|
  opt.banner = 'Usage: nrec [options] file1 file2 ...'
  opt.on '-v', '--verbose', 'Output more information' do 
    options[:verbose] = true
  end
  options[:implementation] = :ruby
  opt.on '-j', '--java', 'Use java implementation' do
    options[:implementation] = :java
  end
  opt.on( '-h', '--help', 'Display this screen' ) do
    puts opt
    exit
  end
end.parse!

# Must set implementation specific library path before requiring libraries.
case options[:implementation]
when :java
  if RUBY_PLATFORM != 'java'
    puts "You must use jnrec instead of nrec if you want to use the -j option."
    exit
  end
  require 'noyes_java'
  include NoyesJava
when :ruby
  require 'noyes'
  include Noyes
end
require 'socket'

def recognize file, node='174.129.244.159', port=2348
  TCPSocket.open(node, port) do |client|
    send_incremental_features file, client, client
  end
end

ARGV.each do |file|
  puts "recognizing file #{file}" if options[:verbose]
  result = recognize file
  puts "\n#{result}"
end
